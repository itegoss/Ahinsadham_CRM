<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donation Receipt</title>
{% load custom_tags %}

<style>
@page {
    size: A4;
    margin: 6mm;
}

* {
    box-sizing: border-box;
}

body {
    font-family: Arial, Helvetica, sans-serif;
    font-size: 11px;
    margin: 0;
    padding: 0;
    color: #000;
    background: #fff;
    line-height: 1.1;
}

.receipt-container {
    max-width: 760px;
    margin: auto;
}

/* Outer boxed receipt to match owner design */
.receipt-box {
    width: 100%;
    border: 1px solid #000;
    border-collapse: collapse;
    background: #fff;
}

.receipt-box td { padding: 4px; }

/* ================= HEADER ================= */
.header-table {
    width: 100%;
    border-collapse: collapse;
}

.header-table td { border: 1px solid #000; padding:6px; vertical-align:middle; }

.logo {
    height: 50px;
    display:block;
    margin: 0 auto;
}

.header-title {
    font-size: 18px;
    font-weight: bold;
    color: #000;
    text-align: center;
    margin-bottom: 2px;
}

.header-sub {
    font-size: 10px;
    text-align: center;
}

/* ================= INFO ================= */
.info-line {
    font-size: 10px;
    margin-top: 4px;
    overflow: hidden;
}

.info-line table { width:100%; border-collapse:collapse; }
.info-line td { border: 1px solid #000; padding:6px; vertical-align:top; }

.info-line span {
    float: right;
}

.info-line b {
    color: #0c6d34;
}

/* ================= SECTION ================= */
.section-title {
    margin-top: 8px;
    padding: 4px 6px;
    background: #e8f5ed;
    border-left: 5px solid #0c6d34;
    font-weight: bold;
    color: #0c6d34;
}

/* ================= TABLE ================= */
.table {
    width: 100%;
    border-collapse: collapse;
    font-size: 10px;
}

.table td, .table th {
    padding: 4px;
    border: 1px solid #000;
    vertical-align: top;
    line-height: 1.0;
}

.table tr:nth-child(even) td {
    background: transparent;
}

.amount {
    text-align: right;
    font-weight: bold;
    color: #0c6d34;
}

.total-row td {
    border-top: 2px solid #000;
    font-weight: bold;
}

/* ================= FOOTER ================= */
.footer-text {
    text-align: center;
    margin-top: 8px;
    font-size: 12px;
    font-weight: bold;
    color: #0c6d34;
}

.signature-table {
    width: 100%;
    margin-top: 12px;
    font-size: 10px;
}
.signature-table td {
    width: 50%;
    text-align: center;
}


/* ================= BUTTONS ================= */
.buttons {
    margin: 18px 0;
    display: flex;
    gap: 10px;
    justify-content: center;
}

.btn {
    background: #0c6d34;
    color: #fff;
    padding: 8px 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
}

/* Icon-only button (square) */
.icon-btn { width: 44px; height: 44px; padding: 0; display: inline-flex; align-items: center; justify-content: center; font-size: 16px; }
.icon-btn svg { width: 20px; height: 20px; display: block }



</style>
</head>

<body>

<div class="receipt-container">
{% if preview %}
<div style="text-align:right; margin:6px 0 0;">
    <a href="{% url download_url_name donation.id %}" target="_blank" style="display:inline-block; padding:6px 10px; background:#0c6d34; color:#fff; text-decoration:none; border-radius:3px; font-size:12px;">Download PDF</a>
</div>
{% endif %}
<table class="receipt-box" width="100%" cellpadding="0" cellspacing="0">
<tr><td style="padding:2px;">



<!-- HEADER -->
<table class="header-table">
<tr>
<td width="12%">
    <img src="{{ logo_url }}" class="logo">
</td>
<td width="88%">
    <div class="header-title">BHAGWAN MAHAVIR PASHU RAKSHA KENDRA</div>
    <div class="header-sub">Organised by : Sheth Shri Lalji Velji Shah</div>
    <div class="header-sub"><b>'Anchorwala Ahinsadham'</b></div>
    <div class="header-sub">Inspired by : Shri Jadavji Ravji Gangar</div>
</td>
</tr>
</table>

<!-- ADDRESS -->
<table class="info-line" style="width:100%; border-collapse:collapse;">
    <tr>
        <!-- LEFT -->
        <td style="width:65%; vertical-align:top;">
            <b>INSTITUTION :</b> Pragpur Road Junction, Taluka Mundra – Kutch, Gujarat 370415
            <b>Contact :</b> 070699 88555 / 070692 88555
        </td>

        <!-- RIGHT -->
        <td style="width:35%; text-align:right; vertical-align:top;">
            <b>Date :</b> {{ donation.donation_date|date:"d-M-y" }}
        </td>
    </tr>
</table>


<div class="info-line">
<table style="width:100%; border-collapse:collapse;">
    <tr>
        <!-- LEFT -->
        <td style="width:65%; vertical-align:top;">
            <b>MUMBAI OFFICE :</b> 5, Gurukrupa Apartment, Kasturba Cross Road No.1,
            Borivali (E), Mumbai 400066
                <b>Contact :</b> 97264 75555 / 97264 85555
  
        </td>

        <!-- RIGHT -->
        <td style="width:35%; text-align:right; vertical-align:top;">
            <b>Receipt No :</b> {{ donation.receipt_id }}
        </td>
    </tr>
</table>
</div>


<div class="info-line">
<table>
<tr>
<td style="width:65%; vertical-align:top; border:1px solid #000; padding:6px;">
    <b>Email :</b> info@ahinsadham.org | mumbai@ahinsadham.org
</td>
</tr>
</table>
</div>


<!-- DONOR DETAILS -->
<div class="section-title">Donor Details</div>
<table class="table">
<tr>
<td width="50%"><b>Name :</b> {{ donation.donor.first_name }} {{ donation.donor.last_name }}</td>
<td width="50%"><b>Mobile :</b> {{ donation.donor.mobile_no }}</td>
</tr>
<tr>
<td><b>Address :</b> 
  {% if donation.donor.house_number %}{{ donation.donor.house_number }}, {% endif %}
  {% if donation.donor.building_name %}{{ donation.donor.building_name }}, {% endif %}
  {% if donation.donor.landmark %}{{ donation.donor.landmark }}, {% endif %}
  {% if donation.donor.area %}{{ donation.donor.area }}, {% endif %}
  {% if donation.donor.city %}{{ donation.donor.city }}, {% endif %}
  {% if donation.donor.state %}{{ donation.donor.state }}, {% endif %}
  {% if donation.donor.country %}{{ donation.donor.country }}, {% endif %}
  {% if donation.donor.postal_code %}{{ donation.donor.postal_code }}{% endif %}
</td>
<td><b>PAN No :</b> {{ donation.donor.pan_number|default:"-" }}</td>
</tr>
<tr>
    <td>.</td>
    <td><b>Aadhar No :</b> {{ donation.donor.id_number|default:"-" }}</td>
</tr>
<tr>
<td><b>Area :</b> {{ donation.donor.area }}</td>
        <td><b>Reference :</b> {{ donation.reference_name|default:"-" }}</td>
</tr>
<tr>
    <td><b>Village :</b> {{ donation.donor.city }}</td>
<td><b>Collector :</b> {{ donation.donation_received_by|default:"-" }}</td>
</tr>
</table>
<!-- DONATION DETAILS -->
<div class="section-title">Detail Of Donation</div>
<table class="table">
<tr>
    <th style="text-align:left;">Donation Category</th>
        <th style="text-align:left;">Donation Sub Category</th>
    <th style="text-align:right;">Amount (Rs.)</th>
</tr>

<tr>
    <td>{{ donation.donation_category.lookup_name }}</td>
        <td>{{ donation.donation_sub_category.lookup_name }}</td>
    <td class="amount">Rs. {{ donation.donation_amount_paid }}</td>
</tr>

<tr class="total-row">
    <td>.</td>
    <td style="text-align:right;">TOTAL</td>
    <td class="amount">Rs. {{ donation.donation_amount_paid }}</td>
</tr>
</table>

<p><b>Amount in Words :</b> {{ donation.donation_amount_paid|number_to_words }}</p>
<p><b>Mode Of Receipt :</b> {{ donation.payment_method.lookup_name }}</p>
<table class="table">
<tr>
    <th style="text-align:left;">Name of Bank : </th>
        <th style="text-align:left;">Branch :{{ donation.bank_name|default:"-" }}  </th>
    <th style="text-align:left;">Cheque / TXN :{{ donation.transaction_id|default:"-" }}</th>
</tr>
</table>
<p><b>Type of donation :</b> Donation </p>

<p style="font-size: 100%;">
Subject to realisation of cheque please send cheque in favour of'Bhagwan Mahavir Pashu Raksha Kendra 
<br>
Trust Regn No. E-12886 Mumbai 80G Certificate Detail Donation is exempted u/s 80G of Income Tax Act  

URN : AAAJB0003AF20213 (AY 2022-23 to 2026-27)
</p>

<br>

<div class="signature">

    <table width="100%" style="margin-top:25px;">
        <tr>
            <td style="width:90%;"></td>
            <td style="width:10%;text-align:center;">   <div>Trustee</div></td>
        </tr>
<tr>
    <td style="width:80%;"></td>

    <td style="width:20%; text-align:center;">
        <img src="{{ signature_url }}" style="height:45px;"><br>
    </td>
</tr>
</table>

</div>

<!-- THANK YOU MESSAGE -->
<div class="footer-text">Thank you for your valuable Donation</div>
<br><br>
</td></tr></table>
</div>
<style>
.mini-btn {
    padding: 0;
    font-size: 0;
    min-width: auto;
    width: 40px;
    height: 40px;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
}

.btn.mini-btn {
    background: #f3f7f5;
    color: #0c6d34;
    border: 1px solid #dbeedd;
}

.btn.mini-btn svg {
    margin: 0;
    width: 18px;
    height: 18px;
    display: block;
}

.btn.mini-btn:hover {
    background: #0c6d34;
    color: #ffffff;
    transition: background 160ms ease, color 160ms ease, transform 160ms ease;
    transform: translateY(-2px);
}
</style>
<!-- ACTION BUTTONS -->
<div class="buttons">
    <!-- PRINT -->
    <button class="btn mini-btn" onclick="window.print()" title="Print" aria-label="Print receipt">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M6 9V3h12v6" stroke-linecap="round" stroke-linejoin="round"/><rect x="6" y="13" width="12" height="8" rx="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 13H4a2 2 0 0 1 2-2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <!-- DOWNLOAD PDF -->
    <a class="btn mini-btn" href="{% url 'download_receipt_pdf' donation.id %}" title="Download PDF" aria-label="Download PDF">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke-linecap="round" stroke-linejoin="round"/><polyline points="7 10 12 15 17 10" stroke-linecap="round" stroke-linejoin="round"/><line x1="12" y1="15" x2="12" y2="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a>

    <!-- BACK -->
    <a class="btn mini-btn" href="{% url 'welcome' %}" title="Back" aria-label="Go back">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.6"><polyline points="15 18 9 12 15 6" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a>

    <!-- SHARE -->
   <button class="btn mini-btn" onclick="shareReceipt()" title="Share Receipt">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
         fill="none" stroke="currentColor" stroke-width="1.8">
        <path d="M22 2L11 13" stroke-linecap="round" stroke-linejoin="round"/>
        <polygon points="22 2 15 22 11 13 2 9"
                 stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
</button>

<script>
function shareReceipt() {
    const pdfUrl = "{% url 'download_receipt_pdf' donation.id %}";

    // 1️⃣ If Web Share API supported
    if (navigator.share) {
        navigator.share({
            title: "Donation Receipt",
            text: "Please find the donation receipt attached.",
            url: pdfUrl
        }).catch(err => {
            console.log("Share cancelled", err);
        });
        return;
    }

    // 2️⃣ Fallback: copy link
    navigator.clipboard.writeText(window.location.origin + pdfUrl)
        .then(() => {
            alert("Receipt link copied. You can share it manually.");
        })
        .catch(() => {
            // 3️⃣ Last fallback: open PDF
            window.open(pdfUrl, "_blank");
        });
}
</script>

</body>
</html>