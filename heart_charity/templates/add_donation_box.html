{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .form-container {
        max-width: 600px;
        margin: auto;
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    label {
        font-weight: 600;
        margin-top: 12px;
        display: block;
    }

    .radio-group {
        display: flex;
        gap: 15px;
        margin-top: 5px;
    }

    .radio-option {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .qr-preview {
        width: 120px;
        height: 120px;
        border: 1px solid #ccc;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border-radius: 5px;
        background: #f9f9f9;
    }

    .qr-preview img {
        width: 100%;
        height: auto;
    }

    .btn-group {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
    }
</style>


<div class="form-container">

    <h3>{{ donation_box|default:"Add New" }} Donation Box</h3>
    <hr>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        {% if donation_box %}
        <label>Donation Box ID</label>
        <input type="text" class="form-control" value="{{ donation_box.donation_id }}" readonly>
        {% endif %}

        <!-- Box Size -->
        <label>Box Size</label>
        <div class="radio-group">
            <label class="radio-option">
                <input type="radio" name="box_size" value="small" required 
                {% if donation_box and donation_box.box_size == 'small' %}checked{% endif %}>
                Small
            </label>

            <label class="radio-option">
                <input type="radio" name="box_size" value="medium" 
                {% if donation_box and donation_box.box_size == 'medium' %}checked{% endif %}>
                Medium
            </label>

            <label class="radio-option">
                <input type="radio" name="box_size" value="large"
                {% if donation_box and donation_box.box_size == 'large' %}checked{% endif %}>
                Large
            </label>
        </div>

        <!-- Key ID -->
        <label>Key ID</label>
        <input type="text" name="key_id" class="form-control" placeholder="Enter Key ID" value="{{ donation_box.key_id|default:'' }}">

        <!-- Location -->
        <label>Location</label>
        <input type="text" name="location" class="form-control" required placeholder="Enter Location" value="{{ donation_box.location|default:'' }}">

        <!-- Status -->
        <label>Status</label>
        <select name="status" class="form-control" required>
            <option value="">Select Status</option>
            {% for key, value in status_choices %}
                <option value="{{ key }}" {% if donation_box and donation_box.status == key %}selected{% endif %}>{{ value }}</option>
            {% endfor %}
        </select>

        <!-- QR Code -->
        <label>Upload QR Code (Optional)</label>
        <input type="file" name="qr_code" class="form-control" accept="image/*" onchange="previewQR(event)">

        <!-- Preview Area -->
        <div class="qr-preview" id="qrPreview">
            {% if donation_box and donation_box.qr_code %}
            <img src="{{ donation_box.qr_code.url }}" alt="QR Code">
            {% else %}
            QR Preview
            {% endif %}
        </div>

        <!-- Created Date (Read Only) -->
        {% if donation_box %}
        <label>Created On</label>
        <input type="text" class="form-control" value="{{ donation_box.created_at|date:'d M Y, h:i A' }}" readonly>
        {% endif %}

        <small class="text-muted">* Donation ID, Created By & Updated By are automatically handled.</small>

        <div class="btn-group">
            <button type="submit" class="btn btn-success">✔ Save</button>
            <a href="#" class="btn btn-secondary">← Cancel</a>
        </div>

    </form>
</div>


<script>
    function previewQR(event) {
        let preview = document.getElementById('qrPreview');
        preview.innerHTML = '';

        let img = document.createElement('img');
        img.src = URL.createObjectURL(event.target.files[0]);

        preview.appendChild(img);
    }
</script>

{% endblock %}
