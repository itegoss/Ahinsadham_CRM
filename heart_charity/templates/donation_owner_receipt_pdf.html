
{% load custom_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Danpeti Receipt</title>
<head>
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<style>
@page {
    size: A5 landscape;
    margin: 6mm 4mm 5mm 4mm;
}
html, body {
    width: 100%;
    margin: 0;
    padding: 0;
}
body {
    font-family: Arial, Helvetica, sans-serif;
    font-size: 9px;
    margin: 0;
    padding: 0;
    color: #000;
    background: #fff;
    line-height: 1.2;
}
.receipt-container {
    max-width: 100%;
    margin: auto;
}
.receipt-box {
    width: 100%;
    border: 1px solid #000;
    border-collapse: collapse;
    background: #fff;
}
.receipt-box td { padding: 2px; }
.bi {
    font-size: 13px;
    vertical-align: middle;
    margin-right: 2px;
}
.header-table {
    width: 100%;
    border-collapse: collapse;
}
.header-table td { border: 1px solid #000; padding:3px; vertical-align:middle; }
.logo {
    height: 75px;
    width: 114%;
    display: block;
    margin: 0 auto;}
.header-title {
    font-size: 17px;
    font-weight: bold;
    color: #000;
    text-align: center;
    margin-bottom: 1px;
}
.header-sub {
    font-size: 15px;
    text-align: center;
}
.info-line {
    font-size: 12px;
    margin-top: 2px;
    overflow: hidden;
}
.info-line table { width:100%; border-collapse:collapse; }
.info-line td { border: 1px solid #000; padding:3px; vertical-align:top; }
.info-line span {
    float: right;
}
.info-line b {
    color: #0c6d34;
}
.section-title {
    margin-top: 4px;
    padding: 2px 4px;
    background: #a0dcb7;
    font-weight: bold;
    font-size: 13px;
}
/* ================= TABLE ================= */
table {
    width: 100%;
       border-collapse: collapse;
       font-size: 12px;
}
.table td, .table th {
    padding: 2px;
    border: 1px solid #000;
    vertical-align: top;
    line-height: 1.0;
}
.table tr:nth-child(even) td {
    background: transparent;
}
.amount {
    text-align: right;
    font-weight: bold;
    color: #0c6d34;
}
.total-row td {
    border-top: 2px solid #000;
    font-weight: bold;
}
/* ================= FOOTER ================= */
.footer-text {
    text-align: center;
    margin-top: 4px;
    font-size: 10px;
    font-weight: bold;
    color: #0c6d34;
    padding: 2px 0;
    border-top: 1px solid #0c6d34;
}
.signature {
    margin-top: 6px;
    display: flex;
    justify-content: space-between;
    font-size: 8px;
}
/* ================= BUTTONS ================= */
.buttons {
    margin: 12px 0;
    display: flex;
    gap: 10px;
    justify-content: center;
}
.mini-btn {
    padding: 0;
    font-size: 0;
    min-width: auto;
    width: 32px;
    height: 32px;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}
.btn.mini-btn {
    background: #f3f7f5;
    color: #0c6d34;
    border: 1px solid #dbeedd;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.btn.mini-btn svg {
    margin: 0;
    width: 16px;
    height: 16px;
    display: block;
}
.btn.mini-btn:hover {
    background: #0c6d34;
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
@media print {
    .buttons, .mini-btn { 
        display: none !important; 
    }
        body {
        margin: 0;
        padding: 0;
    }
   .receipt-box {
    width: 100%;
    border: 1px solid #000;
    border-collapse: collapse;
    background: #fff;
        table-layout: fixed;
}
}
</style>
</head>
<body>
<div class="receipt-container">
<table class="receipt-box" width="100%" cellpadding="0" cellspacing="0">
<tr><td style="padding:2px;">
<table class="header-table">
<tr>
<td width="12%"><img src="{{ logo_url }}" class="logo"></td>
<td width="88%">
    <div class="header-title">BHAGWAN MAHAVIR PASHU RAKSHA KENDRA</div>
    <div class="header-sub">Organised by : Sheth Shri Lalji Velji Shah</div>
    <div class="header-sub"><b>'Anchorwala Ahinsadham'</b></div>
    <div class="header-sub">Inspired by : Shri Jadavji Ravji Gangar</div>
</td>
</tr>
</table>
<table class="info-line1" style="width:100%; border-collapse:collapse;">
    <tr>
        <td style="width:65%; vertical-align:top;">
            <b>INSTITUTION :</b> Pragpur Road Junction, Taluka Mundra â€“ Kutch, Gujarat 370415
            <br>
            <b>Contact :</b> 070699 88555 / 070692 88555 | <b>Email :</b> kutch@ahinsadham.org
        </td>
        <td style="width:35%; text-align:right; vertical-align:top;"><b>Date : {{ payment.date_time|date:"d-M-y" }}</b></td>
    </tr>
</table>
<div class="info-line1">
<table style="width:100%; border-collapse:collapse;">
    <tr>
        <td style="width:65%; vertical-align:top;">
            <b>MUMBAI OFFICE :</b> 5, Gurukrupa Apartment, Kasturba Cross Road No.1,
            Borivali (E), Mumbai 400066
            <br>
                <b>Contact :</b> 97264 75555 / 97264 85555 | <b>Email :</b> mumbai@ahinsadham.org
        </td>
        <td style="width:35%; text-align:right; vertical-align:top;"><b>Receipt No : {{ payment.receipt_id }}</b></td>
    </tr>
</table>
</div>
<div class="section-title">Donor Details</div>
<table class="table">
<tr>
<td width="65%"><b>Name :</b> {{ donor.first_name }} {{ donor.last_name }}</td>
<td width="35%"><b>Box_Id :</b> {{ payment.donation_box.donation_id }}</td>
</tr>
<tr>
<td rowspan="2"><b>Address :</b> 
    {% if donor.house_number %}{{ donor.house_number }}, {% endif %}
  {% if donor.building_name %}{{ donor.building_name }}, {% endif %}
  {% if donor.landmark %}{{ donor.landmark }}, {% endif %}
  {% if donor.area %}{{ donor.area }}, {% endif %}
  {% if donor.city %}{{ donor.city }}, {% endif %}
  {% if donor.state %}{{ donor.state }}, {% endif %}
  {% if donor.country %}{{ donor.country }}, {% endif %}
  {% if donor.postal_code %}{{ donor.postal_code }}{% endif %}
</td>
<td width="50%"><b>PAN No :</b> {{ donor.pan_number|default:"-" }}</td>
</tr>
<tr><td><b>Aadhar No :</b> {{ donor.id_number|default:"-" }}</td></tr>
<tr><td><b>Area :</b> {{ donor.area }}</td><td><b>Collector :</b> {{ payment.verified_by }}</td></tr>
<tr>
<td><b>Village :</b> {{ donor.city }}</td>
<td width="35%"><b>Mobile :</b> {{ donor.contact_number }}</td>
</tr>
</table>
<div class="section-title">Detail Of Donation</div>
<table class="table">
<tr>
    <th  width="65%"style="text-align:left;">Donation Category/Donation Sub Category</th>
    <th  width="35%" style="text-align:right;">Amount (Rs.)</th>
</tr>
<tr>
    <td>{{ donation.donation_category.lookup_name }}/{{ donation.donation_sub_category.lookup_name }}</td>
    <td class="amount"> <b> Rs. {{ payment.amount }}</b></td>
</tr>
<tr class="total-row">
    <td style="text-align:right;">TOTAL</td>
    <td class="amount"> <b>Rs. {{ payment.amount }}</b> </td>
</tr>
</table>
<table class="table">
<tr>
 <th  width="35%" style="text-align:left;">Amount in Words : {{ payment.amount|number_to_words }}</th>
        <th  width="30%" style="text-align:left;">Mode Of Receipt :{{ payment.payment_method.lookup_name }}  </th>
    <th  width="35%" style="text-align:left;">Type of Donation :Danpeti</th>
</tr>
<tr>
    <th style="text-align:left;">Name of Bank : </th>
        <th style="text-align:left;">Branch :{{ donation.bank_name|default:"-" }}  </th>
    <th style="text-align:left;">Cheque / TXN :{{ donation.transaction_id|default:"-" }}</th>
</tr>
</table>
<table width="100%" style="font-size:10px; line-height:1.2;">
    <tr>
        <td width="70%" valign="top" style="padding-right:6px;">
            <div style="text-align:justify;">
                Subject to realisation of cheque please send cheque in favour of
                <b>'Bhagwan Mahavir Pashu Raksha Kendra'</b>.
                <br>
                Trust Regn No. <b>E-12886 Mumbai</b>. Donation is exempted u/s
                <b>80G of Income Tax Act</b>.
                <br>
                URN : <b>AAAJB0003AF20213</b> (AY 2022-23 to 2026-27)
            </div>
        </td>
        <td width="30%" valign="middle" align="right"><img src="{{ signature_url }}" width="100" style="display:block; margin-bottom:2px;">
            <b>Trustee</b>
        </td>
    </tr>
</table>
<div class="footer-text">Thank you for your valuable Donation</div>
<table width="100%" style="margin-top:6px; font-size:9px; border-top:1px solid #000;">
    <tr>
        <td style="padding-top:4px; text-align:center;">
            <b>Follow Us :</b>
            <img src="{{ facebook_icon }}" width="12" valign="middle" />
            &nbsp; | &nbsp;
            <img src="{{ instagram_icon }}" width="12" valign="middle" />
            &nbsp; | &nbsp;
            <img src="{{ youtube_icon }}" width="12" valign="middle" />
             <b>@Ahinsadham</b>
            &nbsp; | &nbsp;
            <img src="{{ globe_icon }}" width="12" valign="middle" />
            <b>www.ahinsadham.org</b>
        </td>
    </tr>
</table>
</td></tr></table>
</div>
<div class="buttons">
    <button class="btn mini-btn" onclick="window.print()" title="Print" aria-label="Print receipt">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"></path>
            <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
    </button>
    <a class="btn mini-btn" href="{% url 'donation_payment_receipt_pdf' payment.id %}" title="Download PDF" aria-label="Download PDF">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="12" y1="18" x2="12" y2="12"></line>
            <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
    </a>
    <a class="btn mini-btn" href="{% url 'welcome' %}" title="Back" aria-label="Go back">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
            <line x1="9" y1="12" x2="21" y2="12"></line>
        </svg>
    </a>
    <button class="btn mini-btn" onclick="shareReceipt()" title="Share Receipt">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
        </svg>
    </button>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const paymentSelect = document.getElementById("payment_method");
    const paymentFields = document.querySelectorAll(".payment-field");
    if (!paymentSelect || paymentFields.length === 0) return;
    function togglePaymentFields() {
        const showFor = ["cheque", "neft", "rtgs", "upi", "bank transfer"];
        const selectedText = paymentSelect.options[
            paymentSelect.selectedIndex
        ].text.trim().toLowerCase();
        paymentFields.forEach(el => {
            el.style.display = showFor.includes(selectedText)
                ? "flex"  
                : "none";
        });
    }
    togglePaymentFields();
    paymentSelect.addEventListener("change", togglePaymentFields);
});
</script>
<script>
function shareReceipt() {
    const pdfUrl = "{% url 'donation_payment_receipt_pdf' payment.id %}";
    if (navigator.share) {
        navigator.share({
            title: "Donation Receipt",
            text: "Please find the donation receipt attached.",
            url: pdfUrl
        }).catch(err => {
            console.log("Share cancelled", err);
        });
        return;
    }
    navigator.clipboard.writeText(window.location.origin + pdfUrl)
        .then(() => {
            alert("Receipt link copied. You can share it manually.");
        })
        .catch(() => {
            window.open(pdfUrl, "_blank");
        });
}
</script>
</body>
</html>